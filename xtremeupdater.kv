#:kivy 1.10.1

#:import theme theme
#:import WindowDragBehavior windowdragbehavior.WindowDragBehavior
#:import Window kivy.core.window.Window
#:import ListItemButton kivy.uix.listview.ListItemButton
#:import DllViewAdapter main.DllViewAdapter
#:import Tweaks tweaks.Tweaks
#:import get_version_number get_version_number.get_version_number
#:import join os.path.join
#:import RelativeLayoutHoveringBehavior hovering_behavior.RelativeLayoutHoveringBehavior

RootLayout:
<CustButton@Button>:
    background_color: Window.clearcolor
    background_normal: 'img/FFFFFF-1.png'
    background_disabled_normal: self.background_normal
    background_down: self.background_normal
    background_disabled_down: self.background_normal

<HeaderLabel@WindowDragBehavior+Label>:
    canvas.before:
        Color:
            rgba: Window.clearcolor

        Rectangle:
            source: 'img/noise_texture_1000x30.png'
            pos: self.pos
            size: self.size

    text: '[color=ddd]Xtreme[/color]Updater'
    font_name: 'fnt/Roboto-Black.ttf'
    text_size: self.size
    halign: 'left'
    padding: 10, 5
    color: theme.prim
    markup: True

<ContentLayout@BoxLayout>:
    orientation: 'vertical'

    canvas.before:
        Color:
            rgba: theme.dark

        Rectangle:
            pos: self.pos
            size: self.size

<HeaderButton@CustButton>:
    size_hint_x: None
    width: self.height
    background_normal: 'img/noise_texture.png'
    border: 0, 0, 0, 0

<IconButton@CustButton>:
    size_hint_x: None
    width: self.height
    font_name: 'fnt/segmdl2.ttf'
    font_size: 20
    background_color: theme.sec
    background_down: self.background_normal

<NavigationButton@CustButton>:
    size_hint_x: None
    width: 120
    background_color: theme.dark
    bold: True
    font_size: 18
    border: [2, 2, 2, 2]
    background_normal: 'img/noise_texture.png'

<IconNavigationButton@NavigationButton+IconButton>

<Navigation@BoxLayout>:
    size_hint_y: None
    height: 40

    canvas.before:
        Color:
            rgba: theme.dark

        Rectangle:
            pos: root.pos
            size: root.size

<PlaceHolder@Label>:
    text: '[size=72][font=fnt/segmdl2.ttf]{}[/font][/size]\n{}'.format(self.icon, self.message)
    markup: True
    color: theme.prim
    font_size: 36
    text_size: self.size
    halign: 'center'
    valign: 'center'

<OverdrawLabel@FloatLayout>:
    size_hint: None, None
    size: 0, 0
    opacity: 0

    Label:
        id: label

        canvas.before:
            Color:
                rgba: theme.sec

            Rectangle:
                pos: self.pos
                size: self.size

        pos: root.wg.pos
        size_hint: None, None
        size: root.wg.size
        color: theme.prim
        markup: True
        font_size: 36
        text_size: self.size
        text: root.template.format(root.icon, root.text)
        halign: 'center'
        valign: 'center'
        opacity: root.opacity

<Content@PageLayout>:
    border: 0

<DllViewItem@ListItemButton>:
    text_size: self.size
    is_selected: self.is_selected and self.selectable
    valign: 'center'
    padding: 40, 0
    background_normal: 'img/FFFFFF-1.png'
    background_down: self.background_normal
    selected_color: theme.prim
    deselected_color: theme.sec
    color: theme.fg if self.selectable else theme.disabled
    size_hint_y: None
    height: 25

    Label:
        text: get_version_number(join(app.root.ids.content_updater_path_info.text, root.text))
        pos: root.pos
        size: root.size
        text_size: self.size
        halign: 'right'
        valign: 'center'
        padding: root.padding
        color: root.color

<DllView@ListView, ScrollView>:
    bar_color: theme.sec
    bar_inactive_color: theme.dark
    bar_width: 10
    scroll_distance: 0
    scroll_wheel_distance: 100
    scroll_type: ['content', 'bars']

    adapter:
        DllViewAdapter(
        data=[],
        args_converter=lambda index, item: {'text': item.get('text', ''), 'selectable': item.get('selectable', False)},
        cls='DllViewItem',
        selection_mode='multiple'
        )

<PathInput@TextInput>:
    size_hint_y: None
    height: 36
    background_color: theme.dark
    cursor_color: theme.prim
    cursor_width: 2
    font_size: 18
    foreground_color: theme.sec
    multiline: False
    selection_color: theme.prim
    on_text_validate: app.root.load_dll_view_data(self.text)
    background_normal: 'img/FFFFFF-0.png'

<DllActionButton@CustButton>:
    size_hint_x: None
    bold: True
    text_size: self.size
    halign: 'center'
    valign: 'bottom'
    padding: 0, 6
    disabled: True

<GameButtonMini@IconButton+RelativeLayoutHoveringBehavior>:
    background_color: 0, 0, 0, 0
    background_normal: 'img/FFFFFF-0.png'
    background_hovering: self.background_normal

<GameButton@Button>:
    background_normal: 'img/FFFFFF-1.png'
    background_down: self.background_normal
    color: 0, 0, 0, 0
    background_color: theme.sec
    size_hint: None, None
    size: 333, 187
    opacity: .5

    CustAsyncImage:
        id: image
        pos: root.pos
        size: root.size
        opacity: 0
        anim_delay: 0.04
        color: theme.prim

    Label:
        id: label
        padding: 20, 10
        text: root.text
        pos: root.pos
        size: root.size
        valign: 'bottom'
        text_size: self.size
        font_name: 'fnt/Roboto-Black.ttf'
        size_hint_y: None
        height: 40
        opacity: .5

        canvas.before:
            Color:
                rgba: theme.sec
            
            Rectangle:
                pos: self.pos
                size: self.size

    GameButtonMini:
        text: '\ue768'
        x: root.x + root.width - self.width
        y: root.y + root.height - self.height
        size: 40, 40
        opacity: float(root.hovering)
        disabled: not root.exe 
        on_release: root.launch_game()


<GameCollection@ScrollView>:
    padding: 40, 0
    size: self.parent.size
    effect_cls: 'OpacityScrollEffect'
    bar_color: theme.sec
    bar_inactive_color: theme.dark
    bar_width: 10
    scroll_distance: 0
    scroll_wheel_distance: 100

    StackLayout:
        id: board
        size_hint_y: None
        height: self.minimum_height


<RootLayout>:
    orientation: 'vertical'

    canvas.after:
        Color:
            rgb: theme.prim

        Rectangle:
            group: 'mouse_highlight'
            source: 'img/mouse_highlight.png'
            pos: self.mouse_highlight_pos
            size: 120, 120

    BoxLayout:
        id: header
        size_hint_y: None
        height: 30

        HeaderLabel:
            id: header_label

        HeaderButton:
            id: minimize_button
            text: '\u2212'
            on_release: Window.minimize()

        HeaderButton:
            id: close_button
            text: '\u00d7'
            on_release: app.stop()

    Navigation:
        id: navigation
        page_layout: content

        NavigationButton:
            id: navCustButtonupdater
            text: 'Updater'
            page_index: 0

        NavigationButton:
            id: navCustButtongames
            text: 'Games'
            page_index: 1

        NavigationButton:
            id: navCustButtonsystem
            text: 'System'
            page_index: 2

        Widget:

        IconNavigationButton:
            text: '\ue734' 
            page_index: 3

        IconNavigationButton:
            text: '\ue713'
            page_index: 4

    Content:
        id: content

        ContentLayout:
            id: content_updater

            BoxLayout:
                size_hint_y: None
                height: 40

                PathInput:
                    id: content_updater_path_info

                IconButton:
                    id: refresh_button
                    disabled: True
                    text: '\ue72c'
                    background_color: theme.dark
                    on_release: app.root.load_dll_view_data(app.root.ids.content_updater_path_info.text)

                IconButton:
                    id: invert_selection_button
                    disabled: True
                    text: '\ue8b3'
                    background_color: theme.dark
                    on_release: root.ids.dll_view.adapter.invert_selection()

                IconButton:
                    text: '\uf12b'
                    background_color: theme.dark
                    on_release: root.load_directory()

            DllView:
                id: dll_view

            BoxLayout:
                id: update_and_restore_layout
                size_hint_y: None
                height: 40
                padding: 10, 0

                canvas.before:
                    Color:
                        rgba: theme.sec

                    Rectangle:
                        pos: update_and_restore_layout.pos
                        size: update_and_restore_layout.size

                Widget:

                DllActionButton:
                    id: restore_button
                    text: 'Restore'
                    font_size: 18
                    on_release: root.restore_callback()

                DllActionButton:
                    id: update_button
                    text: 'Update'
                    font_size: 24
                    on_release: root.update_callback()

        ContentLayout:
            id: content_games

            GameCollection:
                id: game_collection_view


        ContentLayout:
            id: content_system
            padding: 10, 10

            BoxLayout:
                canvas.before:
                    Color:
                        rgba: theme.hover

                    Rectangle:
                        pos: self.pos
                        size: self.size

                size_hint: None, None
                size: 280, 40

                Label:
                    text: "Clear user's temp folder"

                IconButton:
                    text: '\ue74d'
                    on_release: Tweaks.clear_temps()

            PlaceHolder:
                icon: '\ue770'
                message: 'More tweaks coming soon..'

        ContentLayout:
            id: content_favorite

            PlaceHolder:
                icon: '\ue734'
                message: 'Favorite games coming soon'

        ContentLayout:
            id: content_settings

            PlaceHolder:
                icon: '\ue713'
                message: 'Nothing to set yet'

    Label:
        id: info_label
        size_hint_y: None
        height: 30
        text_size: self.size
        halign: 'left'
        font_name: 'fnt/Roboto-Medium.ttf'
        font_size: 12
        padding: 10, 8
        text: "Welcome to XtremeUpdater | Let's start"
        color: theme.prim
