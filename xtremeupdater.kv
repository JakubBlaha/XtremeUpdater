#:kivy 1.10.0

#:import theme theme
#:import WindowDragBehavior main.WindowDragBehavior
#:import PageSwitchBehavior main.PageSwitchBehavior
#:import Thread threading.Thread
#:import WindowDragBehavior main.WindowDragBehavior
#:import Window kivy.core.window.Window
#:import ListAdapter kivy.adapters.listadapter.ListAdapter
#:import SimpleListAdapter kivy.adapters.simplelistadapter.SimpleListAdapter
#:import ListItemButton kivy.uix.listview.ListItemButton
#:import DllViewAdapter main.DllViewAdapter
#:import Tweaks tweaks.Tweaks
#:import DllUpdater main.DllUpdater

RootLayout:
<Widget>:
    font_name: 'fnt/Roboto-Regular.ttf'

<CustButton@Button>:
    background_color: Window.clearcolor
    background_normal: 'img/FFFFFF-1.png'
    background_disabled_normal: self.background_normal
    background_down: self.background_normal
    background_disabled_down: self.background_down

<HeaderLabel@WindowDragBehavior+Label>

<ContentLayout@BoxLayout>:
    orientation: 'vertical'

    canvas.before:
        Color:
            rgba: theme.dark

        Rectangle:
            pos: self.pos
            size: self.size

<HeaderButton@CustButton>:
    size_hint_x: None
    width: self.height

<IconButton@CustButton>:
    size_hint_x: None
    width: self.height
    font_name: 'fnt/segmdl2.ttf'
    font_size: 20
    background_color: theme.sec
    background_down: self.background_normal

<NavigationButton@CustButton>:
    size_hint_x: None
    width: 120
    background_color: theme.dark
    font_name: 'fnt/Roboto-Bold.ttf'
    font_size: 18
    background_normal: 'img/button_noise_with_border.png'
    border: [2, 2, 2, 2]

<IconNavigationButton@NavigationButton+IconButton>
    font_name: 'fnt/segmdl2.ttf'

<Navigation@BoxLayout>:
    size_hint_y: None
    height: 40

    canvas.before:
        Color:
            rgba: theme.dark

        Rectangle:
            pos: root.pos
            size: root.size

<PlaceHolder@Label>:
    text: '[size=72][font=fnt/segmdl2.ttf]{}[/font][/size]\n{}'.format(self.icon, self.message)
    markup: True
    color: theme.prim
    font_size: 36
    text_size: self.size
    halign: 'center'
    valign: 'center'

<OverdrawLabel@FloatLayout>:
    size_hint: None, None
    size: 0, 0
    opacity: 0

    Label:
        id: label

        canvas.before:
            Color:
                rgba: theme.sec

            Rectangle:
                pos: self.pos
                size: self.size

        pos: root.wg.pos
        size_hint: None, None
        size: root.wg.size
        color: theme.prim
        markup: True
        font_size: 36
        text_size: self.size
        text: root.template.format(root.icon, root.text)
        halign: 'center'
        valign: 'center'
        opacity: root.opacity

<Content@PageLayout>:
    border: 0

<DllViewItem@ListItemButton>:
    text_size: self.size
    is_selected: self.is_selected and self.selectable
    valign: 'center'
    padding: 40, 0
    background_normal: 'img/FFFFFF-1.png'
    background_down: self.background_normal
    selected_color: theme.prim
    deselected_color: theme.sec
    color: theme.fg if self.selectable else theme.disabled

<DllView@ListView, ScrollView>:
    bar_color: theme.sec
    bar_inactive_color: theme.dark
    scroll_type: ['content', 'bars']
    bar_width: 10
    scroll_distance: 0
    scroll_wheel_distance: 100

    adapter:
        DllViewAdapter(
        data=[],
        args_converter=lambda index, rec: {'text': rec['text'], 'selectable': rec['selectable'], 'size_hint_y': None, 'height': 25},
        cls='DllViewItem',
        allow_empty_selection=True,
        selection_mode='multiple'
        )

<PathInput@TextInput>:
    size_hint_y: None
    height: 36
    background_color: theme.dark
    cursor_color: theme.prim
    cursor_width: 2
    font_size: 18
    foreground_color: theme.sec
    multiline: False
    selection_color: theme.prim
    on_text_validate: app.root.load_dll_view_data(self.text)
    background_normal: 'img/FFFFFF-0.png'

<DllActionButton@CustButton>:
    size_hint_x: None
    font_name: 'fnt/Roboto-Bold.ttf'
    text_size: self.size
    halign: 'center'
    valign: 'bottom'
    padding: 0, 6

<RootLayout>:
    orientation: 'vertical'

    BoxLayout:
        id: header
        size_hint_y: None
        height: 30

        HeaderLabel:
            id: header_label
            text: 'XtremeUpdater'
            text_size: self.size
            halign: 'left'
            padding: 10, 5
            color: theme.prim

        HeaderButton:
            id: minimize_button
            text: '\u2212'
            on_release: Window.minimize()

        HeaderButton:
            id: close_button
            text: '\u00d7'
            on_release: app.stop()

    Navigation:
        id: navigation
        page_layout: content

        NavigationButton:
            id: navCustButtonupdater
            text: 'Updater'
            page_index: 0

        NavigationButton:
            id: navCustButtongames
            text: 'Games'
            page_index: 1

        NavigationButton:
            id: navCustButtonsystem
            text: 'System'
            page_index: 2

        Widget:

        IconNavigationButton:
            text: '\ue734' 
            page_index: 3

        IconNavigationButton:
            text: '\ue713'
            page_index: 4

    Content:
        id: content

        ContentLayout:
            id: content_updater

            BoxLayout:
                size_hint_y: None
                height: 40

                PathInput:
                    id: content_updater_path_info

                IconButton:
                    disabled: not app.refresh_button_active
                    text: '\ue72c'
                    background_color: theme.dark
                    on_release: app.root.load_dll_view_data(app.root.ids.content_updater_path_info.text)

                IconButton:
                    id: invert_selection_button
                    disabled: True
                    text: '\ue8b3'
                    background_color: theme.dark
                    on_release: root.ids.dll_view.adapter.invert_selection()

                IconButton:
                    text: '\uf12b'
                    background_color: theme.dark
                    on_release: root.load_directory()

            DllView:
                id: dll_view

            BoxLayout:
                id: update_and_restore_layout
                size_hint_y: None
                height: 40
                padding: 10, 0

                canvas.before:
                    Color:
                        rgba: theme.sec

                    Rectangle:
                        pos: update_and_restore_layout.pos
                        size: update_and_restore_layout.size

                Widget:

                DllActionButton:
                    id: restore_button
                    text: 'Restore'
                    font_size: 18
                    on_release: root.restore_callback()

                DllActionButton:
                    id: update_button
                    text: 'Update'
                    font_size: 24
                    on_release: root.update_callback()

        ContentLayout:
            id: content_games

            PlaceHolder:
                icon: '\ue7fc'
                message: 'Game collection coming soon'

        ContentLayout:
            id: content_system
            padding: 10, 10

            BoxLayout:
                canvas.before:
                    Color:
                        rgba: theme.hover

                    Rectangle:
                        pos: self.pos
                        size: self.size

                size_hint: None, None
                size: 280, 40

                Label:
                    text: "Clear user's temp folder"

                IconButton:
                    text: '\ue74d'
                    on_release: Tweaks.clear_temps()

            PlaceHolder:
                icon: '\ue770'
                message: 'More tweaks coming soon..'

        ContentLayout:
            id: content_favorite

            PlaceHolder:
                icon: '\ue734'
                message: 'Favorite games coming soon'

        ContentLayout:
            id: content_settings

            PlaceHolder:
                icon: '\ue713'
                message: 'Nothing to set yet'

    Label:
        id: info_label
        size_hint_y: None
        height: 30
        text_size: self.size
        halign: 'left'
        font_name: 'fnt/Roboto-Medium.ttf'
        font_size: 12
        padding: 10, 8
        text: "Welcome to XtremeUpdater | Let's start"
        color: theme.prim
